---
title: "Data Cleaning"
author: "David Sutton"
date: "2/19/2020"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(haven)
library(janitor)
library(rvest)
library(shiny)
options(scipen=999)
```

```{r, include = FALSE}

load("~/CCES.RData")

# Cleaning CCES Data. First, copying the dataset.

CCES_Panel <- CCES_Panel_Full3waves_VV_V4

# Then, finding the switchers in 2010-2014 CCES panel

CCES_Panel$pres.switch <- if_else((CCES_Panel$CC10_317 < 3 & CCES_Panel$CC12_410a < 3 & CCES_Panel$CC10_317 != CCES_Panel$CC12_410a), 1, 0)

# Now, isolating:

# 2008-2012 Presidential switchers:

pres12 <- CCES_Panel_Full3waves_VV_V4 %>%
  filter(CC10_317 < 3, CC12_410a < 3, CC10_317 != CC12_410a)

# then, House of Rep 2010-2012;

house12 <- CCES_Panel_Full3waves_VV_V4 %>%
  filter(CC10_412 < 3, CC12_412 < 3, CC10_412 != CC12_412)

# then, House of Rep 2012-2014.

house14 <- CCES_Panel_Full3waves_VV_V4 %>%
  filter(CC12_412 < 3, CC14_412 < 3, CC12_412 != CC14_412)

# Making one dataset of House of R switchers

house.switchers <- full_join(house12, house14)

# Making one dataset of House of R and Pres '08-'12

switchers <- full_join(house.switchers, pres12)

# Now, writing code to drop variables we don't want/keep variables we want, filter a couple variables, renaming the variables and creating an "Age" column for each new dataset derived from the CCES (no pres12 yet).

house12_vars <- house12 %>%
  subset(select = c(caseid, birthyr_12, gender_12, race_12, CC10_412, CC12_412, CC12_302, CC12_303d, CC12_308a, CC12_308b, CC12_315a, CC12_320, CC12_321, CC12_322_1:CC12_322_6, CC12_324:CC12_329, CC12_341A, CC12_341C:CC12_341F, CC12_341M, CC12_350, CC12_367, CC12_387_1:CC12_387_13, CC12_418aa, CC12_422a:CC12_423bb, pid7_12, pid3_12, ideo5_12, pew_prayer_12, religpew_12, faminc_12, educ_12, StateAbbr_12)) %>%
  filter(CC12_303d < 5, pid7_12 < 9) %>%
  mutate("Age" = (2012 - birthyr_12))
# Observations reduced from 472 to 470

house14_vars <- house14 %>%
  subset(select = c(caseid, birthyr_14, gender_14, race_14, CC12_412, CC14_412, CC14_302, CC14_303d, CC14_308a, CC14_308b, CC14_315a, CC14_320, CC14_321, CC14_322_1:CC14_322_6, CC14_324:CC14_329, CC14_341A, CC14_341C:CC14_341F, CC14_341M, CC14_350, CC14_367, CC14_387_1:CC14_387_13, CC14_418aa, CC14_422a:CC14_423bb, pid7_14, pid3_14, ideo5_14, pew_prayer_14, religpew_14, faminc_14, educ_14, StateAbbr_14)) %>%
  filter(CC14_303d < 5, pid7_14 < 9) %>%
  mutate("Age" = (2014 - birthyr_14))
# Observations reduced from 460 to 441

pres12_vars <- pres12 %>%
  subset(select = c(caseid, birthyr_12, gender_12, race_12, CC10_317, CC12_410a, CC12_302, CC12_303d, CC12_308a, CC12_308b, CC12_315a, CC12_320, CC12_321, CC12_322_1:CC12_322_6, CC12_324:CC12_329, CC12_341A, CC12_341C:CC12_341F, CC12_341M, CC12_350, CC12_367, CC12_387_1:CC12_387_13, CC12_418aa, CC12_422a:CC12_423bb, pid7_12, pid3_12, ideo5_12, pew_prayer_12, religpew_12, faminc_12, educ_12, StateAbbr_12)) %>%
  filter(CC12_303d < 5, pid7_12 < 9) %>%
  mutate("Age" = (2012 - birthyr_12))
# Observations reduced from 315 to 313

# Renaming variables in new datasets.

house12_vars <- rename(house12_vars, housevote10 = CC10_412, housevote12 = CC12_412, economy12 = CC12_302, fedtax.retro12 = CC12_303d, obama.app12 = CC12_308a, congress.app12 = CC12_308b, guncontrol12 = CC12_320, climate12 = CC12_321, immg.status12 = CC12_322_1, immg.borderpatrol12 = CC12_322_2, immg.policeqs12 = CC12_322_3, immg.finebiz12 = CC12_322_4, immg.pubgoods12 = CC12_322_5, immg.citzdenial12 = CC12_322_6, abortion12 = CC12_324, jobs.envir12 = CC12_325, gaymarriage12 = CC12_326, affirmact12 = CC12_327, balbudget1.12 = CC12_328, balbudget2.12 = CC12_329, selfideo12 = CC12_341A, obamaideo12 = CC12_341C, romneyideo12 = CC12_341D, demideo12 = CC12_341E, repideo12 = CC12_341F, houserepideo12 = CC12_341M, partyreg12 = CC12_350, repHouserep12 = CC12_367, docvisit12 = CC12_387_1, newchild12 = CC12_387_10, moveoutchild12 = CC12_387_11, newmarriage12 = CC12_387_12, newdivorce12 = CC12_387_13, descriptrep.race.eth12 = CC12_418aa, AAraceresentA12 = CC12_422a, AAraceresentB12 = CC12_422b, Hispraceresent12 = CC12_423aa, state12 = StateAbbr_12)

house14_vars <- rename(house14_vars, housevote12 = CC12_412, housevote14 = CC14_412, economy14 = CC14_302, fedtax.retro14 = CC14_303d, obama.app14 = CC14_308a, congress.app14 = CC14_308b, guncontrol14 = CC14_320, climate14 = CC14_321, immg.status14 = CC14_322_1, immg.borderpatrol14 = CC14_322_2, immg.policeqs14 = CC14_322_3, immg.finebiz14 = CC14_322_4, immg.pubgoods14 = CC14_322_5, immg.citzdenial14 = CC14_322_6, abortion14 = CC14_324, jobs.envir14 = CC14_325, gaymarriage14 = CC14_326, affirmact14 = CC14_327, balbudget1.14 = CC14_328, balbudget2.14 = CC14_329, selfideo14 = CC14_341A, obamaideo14 = CC14_341C, demideo14 = CC14_341E, repideo14 = CC14_341F, houserepideo14 = CC14_341M, partyreg14 = CC14_350, repHouserep14 = CC14_367, docvisit14 = CC14_387_1, newchild14 = CC14_387_10, moveoutchild14 = CC14_387_11, newmarriage14 = CC14_387_12, newdivorce14 = CC14_387_13, descriptrep.race.eth14 = CC14_418aa, AAraceresentA14 = CC14_422a, AAraceresentB14 = CC14_422b, Hispraceresent14 = CC14_423aa, state14 = StateAbbr_14)

pres12_vars <- rename(pres12_vars, presvote08 = CC10_317, presvote12 = CC12_410a, economy12 = CC12_302, fedtax.retro12 = CC12_303d, obama.app12 = CC12_308a, congress.app12 = CC12_308b, guncontrol12 = CC12_320, climate12 = CC12_321, immg.status12 = CC12_322_1, immg.borderpatrol12 = CC12_322_2, immg.policeqs12 = CC12_322_3, immg.finebiz12 = CC12_322_4, immg.pubgoods12 = CC12_322_5, immg.citzdenial12 = CC12_322_6, abortion12 = CC12_324, jobs.envir12 = CC12_325, gaymarriage12 = CC12_326, affirmact12 = CC12_327, balbudget1.12 = CC12_328, balbudget2.12 = CC12_329, selfideo12 = CC12_341A, obamaideo12 = CC12_341C, romneyideo12 = CC12_341D, demideo12 = CC12_341E, repideo12 = CC12_341F, houserepideo12 = CC12_341M, partyreg12 = CC12_350, repHouserep12 = CC12_367, docvisit12 = CC12_387_1, newchild12 = CC12_387_10, moveoutchild12 = CC12_387_11, newmarriage12 = CC12_387_12, newdivorce12 = CC12_387_13, descriptrep.race.eth12 = CC12_418aa, AAraceresentA12 = CC12_422a, AAraceresentB12 = CC12_422b, Hispraceresent12 = CC12_423aa, state12 = StateAbbr_12)

CCES_Panel.vars <- rename(CCES_Panel, presvote08 = CC10_317, presvote12 = CC12_410a, economy12 = CC12_302, fedtax.retro12 = CC12_303d, obama.app12 = CC12_308a, congress.app12 = CC12_308b, guncontrol12 = CC12_320, climate12 = CC12_321, immg.status12 = CC12_322_1, immg.borderpatrol12 = CC12_322_2, immg.policeqs12 = CC12_322_3, immg.finebiz12 = CC12_322_4, immg.pubgoods12 = CC12_322_5, immg.citzdenial12 = CC12_322_6, abortion12 = CC12_324, jobs.envir12 = CC12_325, gaymarriage12 = CC12_326, affirmact12 = CC12_327, balbudget1.12 = CC12_328, balbudget2.12 = CC12_329, selfideo12 = CC12_341A, obamaideo12 = CC12_341C, romneyideo12 = CC12_341D, demideo12 = CC12_341E, repideo12 = CC12_341F, houserepideo12 = CC12_341M, partyreg12 = CC12_350, repHouserep12 = CC12_367, docvisit12 = CC12_387_1, newchild12 = CC12_387_10, moveoutchild12 = CC12_387_11, newmarriage12 = CC12_387_12, newdivorce12 = CC12_387_13, descriptrep.race.eth12 = CC12_418aa, AAraceresentA12 = CC12_422a, AAraceresentB12 = CC12_422b, Hispraceresent12 = CC12_423aa, state12 = StateAbbr_12)

CCES_Panel.vars <- CCES_Panel.vars %>%
  mutate("Age.12" = (2012 - birthyr_12), "Age.14" = (2014 - birthyr_14))
```

```{r, echo = FALSE}

# Some preliminary analysis
  # Regressing House 2012 Democrat-to-Republican switchers on demographic data

house12DtoR.demo <- lm(cbind(house12_vars$housevote10 == 1) ~ race_12 + gender_12 + Age + educ_12 + faminc_12, data = house12_vars)

summary(house12DtoR.demo)

  # Regressing House 2012 Democrat-to-Republican switchers on policy positions

house12DtoR.policy <- lm(cbind(house12_vars$housevote10 == 1) ~ guncontrol12 + climate12 + immg.status12 + immg.borderpatrol12 + immg.policeqs12 + immg.finebiz12 + immg.pubgoods12 + immg.citzdenial12 + abortion12 + jobs.envir12 + gaymarriage12 + affirmact12 + balbudget1.12 + balbudget2.12, data = house12_vars)

summary(house12DtoR.policy)

  # Regressing House 2012 Democrat-to-Republican switchers on life events

house12DtoR.life <- lm(cbind(house12_vars$housevote10 == 1) ~ docvisit12 + newchild12 + moveoutchild12 + newmarriage12 + newdivorce12, data = house12_vars)

summary(house12DtoR.life)

  # Regressing House 2012 Democrat-to-Republican switchers on racial attitudes

house12DtoR.raceatt <- lm(cbind(house12_vars$housevote10 == 1) ~ AAraceresentA12 + AAraceresentB12 + Hispraceresent12, data = house12_vars)

summary(house12DtoR.raceatt)

  # Regressing President 2012 Democrat-to-Republican switchers on demographic data

pres12DtoR.demo <- lm(cbind(pres12_vars$presvote12 == 2) ~ race_12 + gender_12 + Age + educ_12 + faminc_12, data = pres12_vars)

summary(pres12DtoR.demo)

  # Regressing President 2012 Democrat-to-Republican switchers on policy positions

pres12DtoR.policy <- lm(cbind(pres12_vars$presvote12 == 2) ~ guncontrol12 + climate12 + immg.status12 + immg.borderpatrol12 + immg.policeqs12 + immg.finebiz12 + immg.pubgoods12 + immg.citzdenial12 + abortion12 + jobs.envir12 + gaymarriage12 + affirmact12 + balbudget1.12 + balbudget2.12, data = pres12_vars)

summary(pres12DtoR.policy)

  # Regressing President 2012 Democrat-to-Republican switchers on life events

pres12DtoR.life <- lm(cbind(pres12_vars$presvote12 == 2) ~ docvisit12 + newchild12 + moveoutchild12 + newmarriage12 + newdivorce12, data = pres12_vars)

summary(pres12DtoR.life)

  # Regressing President 2012 Democrat-to-Republican switchers on racial attitudes

pres12DtoR.raceatt <- lm(cbind(pres12_vars$presvote12 == 2) ~ AAraceresentA12 + AAraceresentB12 + Hispraceresent12, data = pres12_vars)

summary(pres12DtoR.raceatt)

  # Regressing McCain 2008 voters on racial attitudes towards Blacks

McCain08_racialresentment <- lm(cbind(CCES_Panel_Full3waves_VV_V4$CC10_317 == 2) ~ CC10_422a + CC10_422b, data = CCES_Panel_Full3waves_VV_V4)

summary(McCain08_racialresentment)
```

```{r, echo = FALSE}

# some plots

# 2008 voters on racial attitudes towards Blacks and Hispanics, by vote for president

CCES_Panel_Full3waves_VV_V4 %>%
  filter(CC12_317 < 3, CC12_422a < 6) %>%
  ggplot(aes(CC12_422a)) + geom_bar(aes(y = (..count..)/sum(..count..))) + geom_text(aes(label = scales::percent(..prop..), y= ..prop.. ), stat= "count", vjust = -.5) + xlab("Response") + ylab("Portion") + scale_x_continuous(breaks = c(1, 2, 3, 4, 5), label = c("Strongly agree", "Somewhat agree", "Neither agree nor disagree", "Somewhat disagree", "Strongly disagree")) + ggtitle("Racial Resentment of Blacks - 1", subtitle = "The Irish, Italians, Jews and many other minorities overcame prejudice and worked their way up.\nBlacks should do the same without any special favors.") + theme(axis.text.x = element_text(hjust = 1, angle = 30)) + facet_wrap(~ CC12_317, labeller = labeller(CC12_317 = c("1" = "'08 Obama Voters", "2" = "'08 McCain Voters")))

CCES_Panel_Full3waves_VV_V4 %>%
  filter(CC12_317 < 3, CC12_422b < 6) %>%
  ggplot(aes(CC12_422b)) + geom_bar(aes(y = (..count..)/sum(..count..))) + geom_text(aes(label = scales::percent(..prop..), y= ..prop.. ), stat= "count", vjust = -.5) + xlab("Response") + ylab("Portion") + scale_x_continuous(breaks = c(1, 2, 3, 4, 5), label = c("Strongly agree", "Somewhat agree", "Neither agree nor disagree", "Somewhat disagree", "Strongly disagree")) + ggtitle("Racial Resentment of Blacks - 2", subtitle = "Generations of slavery and discrimination have created conditions that make it difficult for Blacks\nto work their way out of the lower class.") + theme(axis.text.x = element_text(hjust = 1, angle = 30)) + facet_wrap(~ CC12_317, labeller = labeller(CC12_317 = c("1" = "'08 Obama Voters", "2" = "'08 McCain Voters")))

CCES_Panel_Full3waves_VV_V4 %>%
  filter(CC12_317 < 3, CC12_423aa < 6) %>%
  ggplot(aes(CC12_423aa)) + geom_bar(aes(y = (..count..)/sum(..count..))) + geom_text(aes(label = scales::percent(..prop..), y= ..prop.. ), stat= "count", vjust = -.5) + xlab("Response") + ylab("Portion") + scale_x_continuous(breaks = c(1, 2, 3, 4, 5), label = c("Strongly agree", "Somewhat agree", "Neither agree nor disagree", "Somewhat disagree", "Strongly disagree")) + ggtitle("Racial Resentment of Hispanics - 1", subtitle = "The Irish, Italians, Jews and many other minorities overcame prejudice and worked their way up.\nHispanics should do the same without any special favors.") + theme(axis.text.x = element_text(hjust = 1, angle = 30)) + facet_wrap(~ CC12_317, labeller = labeller(CC12_317 = c("1" = "'08 Obama Voters", "2" = "'08 McCain Voters")))

CCES_Panel_Full3waves_VV_V4 %>%
  filter(CC12_317 < 3, CC12_423bb < 6) %>%
  ggplot(aes(CC12_423bb)) + geom_bar(aes(y = (..count..)/sum(..count..))) + geom_text(aes(label = scales::percent(..prop..), y= ..prop.. ), stat= "count", vjust = -.5) + xlab("Response") + ylab("Portion") + scale_x_continuous(breaks = c(1, 2, 3, 4, 5), label = c("Strongly agree", "Somewhat agree", "Neither agree nor disagree", "Somewhat disagree", "Strongly disagree")) + ggtitle("Racial Resentment of Hispanics - 2", subtitle = "Generations of slavery and discrimination have created conditions that make it difficult for\nHispanics to work their way out of the lower class.") + theme(axis.text.x = element_text(hjust = 1, angle = 30)) + facet_wrap(~ CC12_317, labeller = labeller(CC12_317 = c("1" = "'08 Obama Voters", "2" = "'08 McCain Voters")))

# Change in Presidential Approval in general public vs changes in presidential approval in switchers

CCES_Panel_Full3waves_VV_V4 %>%
  filter(CC10_308a < 5, CC12_308a < 5, CC14_308a < 5) %>%
  ggplot(aes(as.numeric(CC10_308a - CC14_308a))) + geom_bar() + geom_text(aes(label = scales::percent(..prop..), y= ..prop.. ), stat= "count", vjust = 1) + xlab("<-Negative Movement Positive->") + ylab("Respondents") + ggtitle("Change in Presidential Approval from 2010 to 2014: General Public")

# Change in presidential approval in switchers

CCES_Panel_Full3waves_VV_V4 %>%
  filter(CC10_308a < 5, CC12_308a < 5, CC14_308a < 5, CC10_317 < 3, CC12_410a < 3, CC10_317 != CC12_410a) %>%
  ggplot(aes(as.numeric(CC10_308a - CC14_308a))) + geom_bar() + geom_text(aes(label = scales::percent(..prop..), y= ..prop.. ), stat= "count", vjust = 1) + xlab("<-Negative Movement Positive->") + ylab("Respondents") + ggtitle("Change in Presidential Approval from 2010 to 2014: Switchers")

# Change in presidential approval for D-to-R switchers

CCES_Panel_Full3waves_VV_V4 %>%
  filter(CC10_308a < 5, CC12_308a < 5, CC14_308a < 5, CC10_317 == 1, CC12_410a == 2) %>%
  ggplot(aes(as.numeric(CC10_308a - CC14_308a))) + geom_bar() + geom_text(aes(label = scales::percent(..prop..), y= ..prop.. ), stat= "count", vjust = 1) + xlab("<-Negative Movement Positive->") + ylab("Respondents") + ggtitle("Change in Presidential Approval from 2010 to 2014: Dem-to-Rep Switchers")

# Change in presidential approval for R-to-D switchers

CCES_Panel_Full3waves_VV_V4 %>%
  filter(CC10_308a < 5, CC12_308a < 5, CC14_308a < 5, CC10_317 == 2, CC12_410a == 1) %>%
  ggplot(aes(as.numeric(CC10_308a - CC14_308a))) + geom_bar() + geom_text(aes(label = scales::percent(..prop..), y= ..prop.. ), stat= "count", vjust = 1) + xlab("<-Negative Movement Positive->") + ylab("Respondents") + ggtitle("Change in Presidential Approval from 2010 to 2014: Rep-to-Dem Switchers")
```

-----------------------------

# Milestone 5

```{r, echo = FALSE}

## Pres 08-12

# Who switches? Regressing switching on data points

prob.pres.switch <- lm(cbind(CCES_Panel.vars$pres.switch == 1) ~ race_12 + gender_12 + Age.12 + educ_12 + faminc_12 + guncontrol12 + climate12 + immg.status12 + immg.borderpatrol12 + immg.policeqs12 + immg.finebiz12 + immg.pubgoods12 + immg.citzdenial12 + abortion12 + jobs.envir12 + gaymarriage12 + affirmact12 + balbudget1.12 + balbudget2.12 + docvisit12 + newchild12 + moveoutchild12 + newmarriage12 + newdivorce12 + AAraceresentA12 + AAraceresentB12 + Hispraceresent12, data = CCES_Panel.vars)

prob.pres.switch

prob.presDtoR.switch <- lm(cbind(CCES_Panel.vars$presvote12 == 2 & CCES_Panel.vars$presvote08 == 1) ~ race_12 + gender_12 + Age.12 + educ_12 + faminc_12 + guncontrol12 + climate12 + immg.status12 + immg.borderpatrol12 + immg.policeqs12 + immg.finebiz12 + immg.pubgoods12 + immg.citzdenial12 + abortion12 + jobs.envir12 + gaymarriage12 + affirmact12 + balbudget1.12 + balbudget2.12 + docvisit12 + newchild12 + moveoutchild12 + newmarriage12 + newdivorce12 + AAraceresentA12 + AAraceresentB12 + Hispraceresent12, data = CCES_Panel.vars)

prob.presDtoR.switch

prob.presRtoD.switch <- lm(cbind(CCES_Panel.vars$presvote12 == 1 & CCES_Panel.vars$presvote08 == 2) ~ race_12 + gender_12 + Age.12 + educ_12 + faminc_12 + guncontrol12 + climate12 + immg.status12 + immg.borderpatrol12 + immg.policeqs12 + immg.finebiz12 + immg.pubgoods12 + immg.citzdenial12 + abortion12 + jobs.envir12 + gaymarriage12 + affirmact12 + balbudget1.12 + balbudget2.12 + docvisit12 + newchild12 + moveoutchild12 + newmarriage12 + newdivorce12 + AAraceresentA12 + AAraceresentB12 + Hispraceresent12, data = CCES_Panel.vars)

prob.presRtoD.switch

# Who are these switchers? 

  # Demographics:
    
    # By race (percentage on y axis):

ggplot(pres12_vars, aes(race_12, race_12/sum(race_12), fill = reorder(presvote12, race_12/sum(race_12)))) + geom_col() + scale_y_continuous(labels = scales::percent) + xlab("Race of Switchers") + ylab("Percentage of Switchers") + ggtitle("President 2012 Switchers by Race") + scale_x_continuous(breaks = c(1, 2, 3, 4, 5, 6, 7), label = c("White", "Black", "Hispanic", "Asian", "Native American", "Mixed", "Other")) + theme(panel.background = element_rect("white"), axis.line.x.bottom = element_line("black"), axis.line.y.left = element_line("black")) + scale_fill_manual("Voted for", labels = c("Romney", "Obama"), values=c("red", "blue"))

      # or (total on y axis),

ggplot(pres12_vars, aes(race_12, sum(race_12), fill = reorder(presvote12, race_12/sum(race_12)))) + geom_col() + xlab("Race of Switchers") + ylab("Switchers") + ggtitle("President 2012 Switchers by Race") + scale_x_continuous(breaks = c(1, 2, 3, 4, 5, 6, 7), label = c("White", "Black", "Hispanic", "Asian", "Native American", "Mixed", "Other")) + theme(panel.background = element_rect("white"), axis.line.x.bottom = element_line("black"), axis.line.y.left = element_line("black")) + scale_fill_manual("Voted for", labels = c("Romney", "Obama"), values=c("red", "blue"))

      # side by side, percentage
        # making two new columns (one for D-to-R switchers, one for R-to-D switchers).

      # side by side, total

ggplot(pres12_vars, aes(race_12, fill = reorder(presvote12, race_12/sum(race_12)))) + geom_bar(position = "dodge") + xlab("Race of Switchers") + ylab("Switchers") + ggtitle("President 2012 Switchers by Race") + scale_x_continuous(breaks = c(1, 2, 3, 4, 5, 6, 7), label = c("White", "Black", "Hispanic", "Asian", "Native American", "Mixed", "Other")) + theme(panel.background = element_rect("white"), axis.line.x.bottom = element_line("black"), axis.line.y.left = element_line("black")) + scale_fill_manual("Voted for", labels = c("Romney", "Obama"), values=c("red", "blue"))



    # By sex:

ggplot(pres12_vars, aes(gender_12, gender_12/sum(gender_12), fill = reorder(presvote12, gender_12/sum(gender_12)))) + geom_col() + scale_y_continuous(labels = scales::percent) + xlab("Gender of Switchers") + ylab("Percentage of Switchers") + ggtitle("President 2012 Switchers by Gender") + scale_x_continuous(breaks = c(1, 2), label = c("Male", "Female")) + theme(panel.background = element_rect("white"), axis.line.x.bottom = element_line("black"), axis.line.y.left = element_line("black")) + scale_fill_manual("Voted for", labels = c("Romney", "Obama"), values=c("red", "blue"))

    # By age (new variable added - agegroup)

pres12_vars <- pres12_vars %>%
  mutate(agegroup = case_when(Age >= 18 & Age <= 24 ~ '1', Age >= 25 & Age <= 34 ~ '2', Age >= 35 & Age <= 44 ~ '3', Age >= 45 & Age <= 54 ~ '4', Age >= 55 & Age <= 64 ~ '5', Age >= 65 & Age <= 74 ~ '6', Age >= 75 & Age <= 84 ~ '7', Age >= 85 & Age <= 94 ~ '8'))

pres12_vars$agegroup <- as.numeric(pres12_vars$agegroup)

ggplot(pres12_vars, aes(agegroup, agegroup/sum(agegroup), fill = reorder(presvote12, agegroup/sum(agegroup)))) + geom_col() + scale_y_continuous(labels = scales::percent) + xlab("Age of Switchers") + ylab("Percentage of Switchers") + ggtitle("President 2012 Switchers by Age") + scale_x_continuous(breaks = c(1, 2, 3, 4, 5, 6, 7, 8), label = c("18-24", "25-34", "35-44", "45-54", "55-64", "65-74", "75-84", "85-94")) + theme(panel.background = element_rect("white"), axis.line.x.bottom = element_line("black"), axis.line.y.left = element_line("black")) + scale_fill_manual("Voted for", labels = c("Romney", "Obama"), values=c("red", "blue"))

    # By education

pres12_vars %>%
  filter(educ_12 < 7) %>%
  ggplot(aes(educ_12, educ_12/sum(educ_12), fill = reorder(presvote12, educ_12/sum(educ_12)))) + geom_col() + scale_y_continuous(labels = scales::percent) + xlab("Education Level") + ylab("Percentage of Switchers") + ggtitle("President 2012 Switchers by Education") + scale_x_continuous(breaks = c(1, 2, 3, 4, 5, 6), label = c("No High School", "High school graduate", "Some college", "2-year", "4-year", "Post-grad")) + theme(panel.background = element_rect("white"), axis.line.x.bottom = element_line("black"), axis.line.y.left = element_line("black")) + scale_fill_manual("Voted for", labels = c("Romney", "Obama"), values=c("red", "blue")) + coord_flip()

    # By party (dropping NAs)

pres12_vars %>%
  filter(partyreg12 < 5) %>%
  ggplot(aes(partyreg12, partyreg12/sum(partyreg12), fill = reorder(presvote12, partyreg12/sum(partyreg12)))) + geom_col() + scale_y_continuous(labels = scales::percent) + xlab("Party of Switchers") + ylab("Percentage of Switchers") + ggtitle("President 2012 Switchers by Party") + scale_x_continuous(breaks = c(1, 2, 3, 4), label = c("None/Ind/Didn't Say", "Democratic", "Republican", "Other")) + theme(panel.background = element_rect("white"), axis.line.x.bottom = element_line("black"), axis.line.y.left = element_line("black")) + scale_fill_manual("Voted for", labels = c("Romney", "Obama"), values=c("red", "blue"))

    # By income (making new variable - "income" - first)

pres12_vars <- pres12_vars %>%
  mutate(income = case_when(faminc_12 >= 1 & faminc_12 <= 3 ~ '1', faminc_12 >= 4 & faminc_12 <= 6 ~ '2', faminc_12 >= 7 & faminc_12 <= 9 ~ '3', faminc_12 >= 10 & faminc_12 <= 11 ~ '4', faminc_12 >= 12 & faminc_12 < 33 ~ '5', faminc_12 >= 32 ~ '6'))

pres12_vars$income <- as.numeric(pres12_vars$income)

ggplot(pres12_vars, aes(income, income/sum(income), fill = reorder(presvote12, income/sum(income)))) + geom_col() + scale_y_continuous(labels = scales::percent) + xlab("Income of Switchers in US Dollars") + ylab("Percentage of Switchers") + ggtitle("President 2012 Switchers by Income") + scale_x_continuous(breaks = c(1, 2, 3, 4, 5, 6), label = c("0-29,999", "30,000-59,999", "60,000-99,999", "100,000-149,999", "150,000+", "Didn't say/Skipped/Not asked")) + theme(panel.background = element_rect("white"), axis.line.x.bottom = element_line("black"), axis.line.y.left = element_line("black")) + scale_fill_manual("Voted for", labels = c("Romney", "Obama"), values=c("red", "blue")) + coord_flip()
```

# Descriptive stuff in one pane, and maybe a drop down panel to pick one, and maybe something that will allow the user to compare two or three demographic/policy groups groups

# Q from class: intercept + 0 * minimum
# or you can center the intercept