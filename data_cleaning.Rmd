---
title: "Data Cleaning"
author: "David Sutton"
date: "2/19/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(haven)
library(janitor)
library(rvest)
load("~/CCES.RData")
ANES <- read_dta("C:/Users/david/Downloads/ANES.dta")
```


```{r, echo = FALSE}
# Cleaning CCES Data. First, 2008-2012 Presidential switchers:

pres12 <- CCES_Panel_Full3waves_VV_V4 %>%
  filter(CC10_317 < 3, CC12_410a < 3, CC10_317 != CC12_410a)

# then, House of R 2010-2012

house12 <- CCES_Panel_Full3waves_VV_V4 %>%
  filter(CC10_412 < 3, CC12_412 < 3, CC10_412 != CC12_412)

# then, House of Rep 2012-2014.

house14 <- CCES_Panel_Full3waves_VV_V4 %>%
  filter(CC12_412 < 3, CC14_412 < 3, CC12_412 != CC14_412)

# Now, writing code to drop variables we don't want/keep variables we want, filter a couple variables, and creating an "Age" column.

house12_vars <- house12 %>%
  subset(select = c(birthyr_12, gender_12, race_12, CC10_412, CC12_412, CC12_302, CC12_303d, CC12_308a, CC12_308b, CC12_315a, CC12_320, CC12_321, CC12_322_1:CC12_322_6, CC12_324:CC12_329, CC12_341A, CC12_341C:CC12_341F, CC12_341M, CC12_350, CC12_367, CC12_387_1:CC12_387_13, CC12_418aa, CC12_422a:CC12_423bb, pid7_12, pid3_12, ideo5_12, pew_prayer_12, religpew_12, faminc_12, educ_12)) %>%
  filter(CC12_303d < 5, pid7_12 < 9) %>%
  mutate("Age" = (2012 - birthyr_12))
```



```{r, echo = FALSE}

# Strength of partisanship for Democrats graph for years 1948-2012

ANES_D <- ANES %>%
filter(VCF0301 < 4) %>%
group_by(VCF0004) %>%
summarize(avg_strength = mean(VCF0301))
ggplot(ANES_D, aes(VCF0004, avg_strength)) + geom_line() + scale_x_continuous(breaks=c(1948, 1956, 1964, 1972, 1980, 1988, 1996, 2004, 2012), labels = c(1948, 1956, 1964, 1972, 1980, 1988, 1996, 2004, 2012), limits=c(1948,2012))+ scale_y_continuous(limits=c(1,3)) + labs(title = "Strength of Partisanship for Democrats, 1948-2012")

# Trying to make Democrat share of vote

PresVoteShare <- read_html("https://en.wikipedia.org/wiki/List_of_United_States_presidential_elections_by_popular_vote_margin")

PresVoteShare_tab <- PresVoteShare %>%
  html_nodes("table")

PresVoteShare_tab <- PresVoteShare_tab[[2]] %>%
  html_table

PresVoteShare_tab <- PresVoteShare_tab[-2, -1] %>%
  filter(Election > 1947) %>%
  subset(select = c(1, 3, 7)) %>%
  arrange(Election)
```
 
 # KEEP UNTIL TRANSFER
 Q for Steve:
1) What challenges will I run into due to the relative lack of "switchers"? [Don't worry about this. You can analyze the switchers by group, and/or aggregate them.]
2) Do I need the weights? [Nope]
3) Can I use the 'who you voted for in 2008' q (asked in 2010)? [Yes]

Also, Steve says consult Key's The Responsible Electorate, and comparing waves to the cross sections
